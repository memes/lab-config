# Overide the default configuration with these values
# Reference generated from kubeadm config print init-defaults --component-configs=KubeletConfiguration
{{ ansible_managed | comment }}
apiVersion: kubeadm.k8s.io/v1beta3
kind: InitConfiguration
bootstrapTokens:
  - groups:
      - system:bootstrappers:kubeadm:default-node-token
    token: {{ kubeadm_token }}
certificateKey: {{ kubeadm_cert_key }}
localAPIEndpoint:
  advertiseAddress: {{ ansible_host }}
nodeRegistration:
  name: {{ inventory_hostname }}
---
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
clusterName: {{ kubernetes_cluster_name | default('lab') }}
controlPlaneEndpoint: {{ kubernetes_api_server }}
networking:
  dnsDomain: {{ kubernetes_dns_domain | default('cluster.local') }}
  serviceSubnet: {{ kubernetes_service_cidr | default('10.1.0.0/22') }}
  podSubnet: {{ kubernetes_pod_cidr | default('10.0.0.0/17') }}
---
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
cgroupDriver: {{ kubernetes_cgroup_driver | default('systemd') }}
clusterDNS:
  - {{ kubernetes_dns_service | default('10.1.0.10') }}
clusterDomain: {{ kubernetes_dns_domain | default('cluster.local') }}
